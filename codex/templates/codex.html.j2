{% extends "base.html.j2" %}
{% block title %}
  {{ collection._id }}
{% endblock title %}
{% block body %}
  <div class="container my-3">
    <span class="h1 align-top">{{ collection._id }}</span>
    <span class="badge bg-primary fs-6 align-top">{{ collection.code | format_code(collection.dbversion) }}</span>
    <br>
    <input type="checkbox"
           class="btn-check"
           id="btn-show-comments"
           checked
           autocomplete="off">
    <label class="btn btn-primary" for="btn-show-comments">Comments Shown</label>
    <br>
    {% if collection.code == "vasp" %}
      Database: {{ collection.dbversion | format_version(collection.code) }}
      <br>
    {% endif %}
  </div>
  <div class="container bg-body-secondary py-3 codex-collection" data-cdxid="{{ collection._id }}"">
    <div class="accordion" id="accordionCodex">
      {% for codex in collection.entries %}
        <div class="accordion-item codex-entry"
             data-uuid="{{ codex._id }}"
             data-dbversion="{{ codex.dbversion }}"
             data-filetype="{{ codex.filetype }}"
             data-code="{{ codex.code }}">
          <h2 class="accordion-header">
            <button class="accordion-button {{ 'collapsed' if loop.index > 1 }}"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#accordion-{{ codex._id }}"
                    aria-expanded="true"
                    aria-controls="accordion-{{ codex._id }}"
                    data-uuid="{{ codex._id }}">
              <tt>{{ codex.filename }}</tt>&nbsp<span class="badge bg-success">{{ codex.filetype | format_filetype(collection.code) }}</span>
            </button>
          </h2>
          <div id="accordion-{{ codex._id }}"
               class="accordion-collapse collapse {{ 'show' if loop.index == 1 }}"
               data-bs-parent="#accordionCodex">
            <div class="accordion-body section">
              <nav aria-label="processed-or-raw-file">
                <ul class="pagination justify-content-center">
                  <li class="page-item active">
                    <span class="page-link" id="processed-link-{{ codex._id }}">Processed</span>
                  </li>
                  <li class="page-item">
                    <span class="page-link" id="raw-link-{{ codex._id }}">Raw</span>
                  </li>
                </ul>
              </nav>
              <div class="container" id="processed-cont-{{ codex._id }}">
                <div class="row">
                  <div class="col-8 p-0">
                    <div class="input-file" data-uuid="{{ codex._id }}">
                      <pre><code class="language-fortran">
{%-           for section_name, section in codex.tags.items(): %}
{%              if section_name %}
{{ codex.section_start_token }}{{ section_name.upper() | e}}
{%              endif %}
{%              for tag in section: %}
{{ codex.indent*codex.pad }}<a href="{{ tag.href }}" class="tag-link" data-name="{{ tag.id }}" data-section="{{ section_name }}">{{ tag.name }}</a>{{ tag.tag_pad*codex.pad }}={{ tag.value_pad*codex.pad }}{{ tag.value }}{{ tag.comment_pad*codex.pad }}{{ codex.comment_token }}{{ tag.comment }}
{%              endfor %}
{%              if codex.section_end_token %}
{{ codex.section_end_token }}
{%              endif %}
{%             endfor %}
{%             if codex.cards -%}
{{ codex.cards }}
{%-             endif %}
</code></pre>
                    </div>
                  </div>
                  <div class="col-4 p-0">
                    <div class="preview px-2 mx-3 my-2" data-uuid={{ codex._id }}>
                    </div>
                  </div>
                </div>
              </div>
              <div class="container" id="raw-cont-{{ codex._id }}">
                <pre><code class="language-fortran">{{ codex.raw_file }}</code></pre>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock body %}
{% block scripts %}
  <script src="{{ url_for('static',filename='codex.js') }}"></script>
  <script src="{{ url_for('static',filename='prism.js') }}"></script>
{% endblock scripts %}
