{% extends "base.html.j2" %}
{% block body %}
  {% for codex in codexes %}
    <div class="section"
         data-fileid="{{ codex.fileid }}"
         data-dbversion="{{ codex.dbversion }}"
         data-filetype="{{ codex.package }}"
         data-code="{{ codex.code }}">
      <h2>{{ codex.filename }}</h2>
      Detected code <b> {{ codex.code }} </b> (package: <tt>{{ codex.package }}.x</tt>)
      <div class="container">
        <div class="row">
          <div class="col-8 p-0">
            <div class="input-file" data-fileid="{{ codex.fileid }}">
              <pre><code class="language-fortran">
{%-           for section_name, section in codex.tags.items(): %}
{%              if section_name %}
{{ codex.section_start_token }}{{ section_name.upper() | e}}
{%              endif %}
{%              for tag in section: %}
{{ codex.indent }}<a href="{{ tag.href }}" class="tag-link" data-name="{{ tag.id }}" data-section="{{ section_name }}">{{ tag.name }}</a>{{ tag.tag_pad }}={{ tag.value_pad }}{{ tag.value }}{{ tag.comment_pad }}{{ codex.comment_token }}{{ tag.comment }}
{%              endfor %}
{%              if codex.section_end_token %}
{{ codex.section_end_token }}
{%              endif %}
{%             endfor %}
{%             if codex.cards -%}
{{ codex.cards }}
{%-             endif %}
</code></pre>
            </div>
          </div>
          <div class="col-4 p-0">
            <div class="preview px-2 mx-3 my-2" data-fileid={{ codex.fileid }}>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% endblock body %}
{% block scripts %}
  <script>
     $(document).ready(function() {
        $('pre').each(function() {
          const code = $(this).find('code').text();
          $(this).prepend('<button class="btn btn-sm btn-outline-primary code-copy" style="float:right; cursor:pointer;">Copy</button>');
          $(this).find('.code-copy').on('click', function() {
            const $button = $(this);
            navigator.clipboard.writeText(code);

            $button.removeClass('btn-outline-primary').addClass('btn-primary');
            $button.text('Copied!');
            setTimeout(function() {
              $button.text('Copy');
              $button.removeClass('btn-primary').addClass('btn-outline-primary');
            }, 1000);
          });
        });
      }); 
  </script>
{% endblock scripts %}
